{% extends "base.html" %}

{% block title %}{% if game_type == 'ttt' %}Tic-Tac-Toe{% elif game_type == 'c4' %}Connect 4{% endif %} Leaderboard{% endblock %}

{% block head %}
<style>
.leaderboard-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.page-title {
  font-size: 2.5em;
  color: var(--accent);
  margin-bottom: 10px;
  text-align: center;
}

.leaderboard-controls {
  display: flex;
  gap: 10px;
  align-items: center;
  margin: 20px 0;
  justify-content: center;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid #203046;
  background: #132238;
  color: var(--text);
  text-decoration: none;
  cursor: pointer;
  user-select: none;
  font-weight: 700;
}

.btn:hover {
  border-color: var(--accent);
}

.leaderboard-table {
  width: 100%;
  border-collapse: collapse;
  background: var(--card, #121821);
  border: 1px solid var(--border, #1d2633);
  border-radius: 12px;
  overflow: hidden;
  margin: 20px 0;
}

.leaderboard-table th,
.leaderboard-table td {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border, #1d2633);
  text-align: left;
}

.leaderboard-table th {
  background: #0f1520;
  color: var(--muted, #9fb0c3);
  font-weight: 600;
}

.leaderboard-table tr:last-child td {
  border-bottom: none;
}

.leaderboard-table tr:nth-child(even) {
  background: rgba(255, 255, 255, 0.02);
}

.rank-column {
  text-align: center;
  width: 60px;
  font-weight: bold;
}

.player-column {
  font-weight: 600;
}

.wins-column,
.plays-column {
  text-align: center;
  width: 80px;
}

.badge {
  margin-right: 8px;
}

.loading {
  text-align: center;
  color: var(--muted, #9fb0c3);
  padding: 40px;
}

.back-section {
  text-align: center;
  margin-top: 30px;
}

.back-section .btn {
  background: var(--bg-secondary, #1a1f2e);
  border: 2px solid var(--border);
  color: var(--text);
}
</style>
{% endblock %}

{% block content %}
<div class="leaderboard-container">
  <h1 class="page-title">
    {% if game_type == 'ttt' %}
      ‚ùå‚≠ï Tic-Tac-Toe Leaderboard
    {% elif game_type == 'c4' %}
      üü°üî¥ Connect 4 Leaderboard
    {% endif %}
  </h1>

  <div class="leaderboard-controls">
    <select id="gameSelect" class="btn">
      <option value="ttt" {% if game_type == 'ttt' %}selected{% endif %}>Tic-Tac-Toe</option>
      <option value="c4" {% if game_type == 'c4' %}selected{% endif %}>Connect 4</option>
    </select>
    <button class="btn" id="refreshBtn">Refresh</button>
  </div>

  <table class="leaderboard-table" id="leaderboardTable">
    <thead>
      <tr>
        <th class="rank-column">#</th>
        <th class="player-column">Player</th>
        <th class="wins-column">Wins</th>
        <th class="plays-column">Plays</th>
      </tr>
    </thead>
    <tbody id="leaderboardBody">
      <tr>
        <td colspan="4" class="loading">Loading leaderboard...</td>
      </tr>
    </tbody>
  </table>

  <div class="back-section">
    <a href="{{ url_for('core.index') }}" class="btn">‚Üê Back to Main Menu</a>
  </div>
</div>

<script>
(async function(){
  const gameSelect = document.getElementById("gameSelect");
  const refreshBtn = document.getElementById("refreshBtn");
  const tbody = document.getElementById("leaderboardBody");

  async function loadLeaderboard() {
    const game = gameSelect.value;

    try {
      tbody.innerHTML = '<tr><td colspan="4" class="loading">Loading...</td></tr>';

      const response = await fetch(`/game/api/leaderboard/${game}`);
      const data = await response.json();

      if (!data.ok) {
        tbody.innerHTML = '<tr><td colspan="4" class="loading">Error loading leaderboard</td></tr>';
        return;
      }

      tbody.innerHTML = "";

      if (data.leaders.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="loading">No players yet</td></tr>';
        return;
      }

      data.leaders.forEach((player, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="rank-column">${index + 1}</td>
          <td class="player-column"><span class="badge">${player.badge}</span>${player.name}</td>
          <td class="wins-column">${player.wins}</td>
          <td class="plays-column">${player.plays}</td>
        `;
        tbody.appendChild(row);
      });

    } catch (error) {
      tbody.innerHTML = '<tr><td colspan="4" class="loading">Network error</td></tr>';
    }
  }

  // Event listeners
  gameSelect.addEventListener("change", () => {
    // Update URL to reflect current game selection
    const url = new URL(window.location);
    url.searchParams.set('game', gameSelect.value);
    window.history.pushState({}, '', url);
    loadLeaderboard();
  });

  refreshBtn.addEventListener("click", loadLeaderboard);

  // Initial load
  loadLeaderboard();
})();
</script>
{% endblock %}