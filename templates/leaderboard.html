{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="back-nav" style="margin-bottom: 20px;">
        <a href="/" class="btn" style="display: inline-flex; align-items: center; gap: 8px;">
            ‚Üê Back to Game
        </a>
    </div>

    <!-- Navigation Tabs -->
    <div style="display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 2px solid #1f2937;">
        <a href="/leaderboard" class="btn" style="background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7); border-radius: 8px 8px 0 0;">
            üèÜ Puzzle Champions
        </a>
        <a href="/daily_leaderboard" class="btn" style="background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7); border-radius: 8px 8px 0 0;">
            üìÖ Daily Rankings
        </a>
        <a href="/war-leaderboard" class="btn" style="background: linear-gradient(135deg, #dc2626, #991b1b); color: white; border-radius: 8px 8px 0 0;">
            ‚öîÔ∏è War Champions
        </a>
    </div>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h1 style="margin: 0;">üèÜ Puzzle Champions</h1>
        <div style="color: rgba(255,255,255,0.7); font-size: 14px;">
            All-time best performances by game mode
        </div>
    </div>

    <div style="display:flex;gap:18px;flex-wrap:wrap;">
        {% for m in leaders.keys() %}
        <div class="card" style="flex:1 1 300px; background: #111827; border: 1px solid #1f2937;">
            <h3 style="color: #22c55e; margin:0 0 16px; text-align: center;">{{ m|capitalize }} Mode</h3>
            <table class="leader" style="width:100%;">
                <thead>
                    <tr style="background: rgba(255,255,255,0.05);">
                        <th style="padding: 8px; text-align: center;">#</th>
                        <th style="padding: 8px;">Player</th>
                        <th style="padding: 8px; text-align: center;">Score</th>
                        <th style="padding: 8px; text-align: center;">Time</th>
                        <th style="padding: 8px; text-align: center;">When</th>
                    </tr>
                </thead>
                <tbody>
                {% for row in leaders[m] %}
                    <tr style="border-bottom: 1px solid #1f2937;">
                        <td style="padding: 8px; text-align: center; font-weight: 600; color: {{ '#ffd700' if loop.index == 1 else '#c0c0c0' if loop.index == 2 else '#cd7f32' if loop.index == 3 else 'rgba(255,255,255,0.8)' }};">
                            {% if loop.index == 1 %}ü•á
                            {% elif loop.index == 2 %}ü•à
                            {% elif loop.index == 3 %}ü•â
                            {% else %}{{ loop.index }}
                            {% endif %}
                        </td>
                        <td style="padding: 8px; color: white; font-weight: 500;">{{ row['email'] }}</td>
                        <td style="padding: 8px; text-align: center; color: #22c55e; font-weight: 600;">{{ row['score'] }}</td>
                        <td style="padding: 8px; text-align: center; color: rgba(255,255,255,0.7);">{{ row['elapsed'] if row['elapsed'] else '-' }}</td>
                        <td style="padding: 8px; text-align: center; color: rgba(255,255,255,0.5); font-size: 12px;">{{ row['created_at'] }}</td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="5" style="opacity:.7; text-align: center; padding: 20px; color: rgba(255,255,255,0.6);">
                            No entries yet. Be the first!
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% endfor %}
    </div>

    <!-- War Champions Quick View -->
    <div class="card" style="background: #111827; border: 1px solid #1f2937; margin-top: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="color: white; margin: 0;">‚öîÔ∏è Top War Champions</h3>
            <a href="/war-leaderboard" class="btn" style="background: #dc2626;">View Full Rankings</a>
        </div>

        <div id="topWarChampions" style="display: flex; flex-direction: column; gap: 8px;">
            <!-- Top war champions will be loaded here -->
        </div>
    </div>
</div>

<script>
// Load top war champions preview
async function loadTopWarChampions() {
    try {
        const response = await fetch('/api/leaderboard/war-wins');
        const data = await response.json();

        const container = document.getElementById('topWarChampions');

        if (data.leaders && data.leaders.length > 0) {
            const top3 = data.leaders.slice(0, 3);
            container.innerHTML = '';

            top3.forEach((leader, index) => {
                const rank = index + 1;
                const rankIcon = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : 'ü•â';
                const rankColor = rank === 1 ? '#ffd700' : rank === 2 ? '#c0c0c0' : '#cd7f32';

                const entryDiv = document.createElement('div');
                entryDiv.style.cssText = `
                    background: rgba(255,255,255,0.05);
                    border-radius: 8px;
                    padding: 12px;
                    display: flex;
                    align-items: center;
                    gap: 12px;
                `;

                entryDiv.innerHTML = `
                    <div style="font-size: 20px; color: ${rankColor};">${rankIcon}</div>
                    <div style="flex: 1; color: white;">${leader.name}</div>
                    <div style="color: #dc2626; font-weight: 600;">‚öîÔ∏è ${leader.wins}</div>
                `;

                container.appendChild(entryDiv);
            });
        } else {
            container.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.6); padding: 20px;">No war champions yet!</div>';
        }
    } catch (err) {
        console.error('Error loading war champions:', err);
    }
}

// Load data when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadTopWarChampions();
});
</script>
{% endblock %}