<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
{% if csrf_token %}<meta name="csrf-token" content="{{ csrf_token }}">{% endif %}
<title>{% block title %}Mini Word Finder{% endblock %}</title>
<link rel="icon" href="/static/images/TheLogo.png">
<link rel="stylesheet" href="/static/css/base.css?v={{ config.ASSET_VERSION }}">
<link rel="stylesheet" href="/static/css/legal.css?v={{ config.ASSET_VERSION }}">
{% block head %}{% endblock %}
</head>
<body data-authenticated="{% if (current_user and current_user.is_authenticated) or session.get('user_id') %}true{% else %}false{% endif %}">

{% if not hide_everything_except_content %}
<!-- Normal layout: nav, main wrapper, footer -->
<nav class="nav">
<a class="brand" href="/">
<img src="/static/images/TheLogo.png" alt="Logo" />
<span>Mini Word Finder</span>
</a>
<span class="spacer"></span>

    {% block nav_actions %}
      <a href="/guide" class="btn ghost">Guide</a>
      <a href="/community" class="btn ghost">Community</a>
      <!-- Credit Badge -->
      <div id="credit-badge" class="credit-badge auth-only">
        Credits: <span class="credit-amount">{{ current_user.mini_word_credits if current_user and current_user.is_authenticated else 0 }}</span>
      </div>
      <a href="/store" id="store-btn" class="btn primary auth-only">ðŸ’Ž Store</a>
      <a href="/wallet" class="btn auth-only">ðŸ’° Wallet</a>
      <a href="/profile" class="btn auth-only">ðŸ§‘ Profile</a>
      {% if current_user and current_user.is_authenticated %}
        <a href="/logout" class="btn secondary auth-only">Logout</a>
      {% else %}
        <a href="{{ url_for('core.login') }}" class="btn secondary">Login</a>
        <a href="{{ url_for('core.register') }}" class="btn primary">Create Account</a>
      {% endif %}
    {% endblock %}

</nav>

<main class="container">
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="{% if category == 'error' %}alert{% else %}success{% endif %}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}
</main>

{% block footer %}
<footer class="footer">
    <div class="container center">
      <strong>Mini Word Finder</strong>
    </div>
  </footer>
{% endblock %}

{% else %}
<!-- Login isolation mode: only flash messages, no nav/footer -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="{% if category == 'error' %}alert{% else %}success{% endif %} flash-message">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}
{% endif %}

<!-- SINGLE content block for all modes -->
{% block content %}{% endblock %}

<script defer src="/static/js/auth-check.js?v={{ config.ASSET_VERSION }}"></script>
<script defer src="/static/js/credits.js?v={{ config.ASSET_VERSION }}"></script>
<script defer src="/static/js/lesson-overlay.js?v={{ config.ASSET_VERSION }}"></script>
<script defer src="/static/js/auto-teach.js?v={{ config.ASSET_VERSION }}"></script>
<script defer src="/static/js/session-monitor.js?v={{ config.ASSET_VERSION }}"></script>

{% block extra_scripts %}{% endblock %}
</body>
</html>